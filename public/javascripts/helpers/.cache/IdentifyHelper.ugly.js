(function(){"use strict";define(["dojo/on","dojo/_base/Deferred","dojo/DeferredList","helpers/templateBuilder","esri/tasks/identify"],function(e,t,n,r){var i,s,o,u;return i=function(e){var t=e.feature;return t.attributes.layerName=e.layerName,t.layerName=e.layerName,r.buildInfoTemplate(t)},s=function(e){var t,n,r;t=[];for(n=0,r=e.length;n<r;n++){var i=new esri.tasks.IdentifyTask(e[n].url);i.identifyLayers=e[n].identifyLayers,t[t.length]=i}return t},o=function(e){var n,r,i;n=[];for(r=0,i=e.length;r<i;r++)n[n.length]=new t;return n},u=function(){this.handler={}},u.prototype.identifyHandler=function(t,r){var u,a,f;this.map=t,u=new esri.tasks.IdentifyParameters,u.tolerance=3,u.returnGeometry=!0,u.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_ALL,a=function(e){var n,r,s,o,a;n=[];for(r=0,o=e.length;r<o;r++)e[r][0]&&(n=n.concat(e[r][1]));for(s=0,a=n.length;s<a;s++)n[s]=i(n[s]);return n.length===0?(t.infoWindow.clearFeatures(),t.infoWindow.hide()):(t.infoWindow.setFeatures(n),t.infoWindow.show(u.geometry)),n},f=s(r),this.handler=e.pausable(this.map,"click",function(e){var r,i,s,l;r=o(f),i=new n(r),i.then(a),u.geometry=e.mapPoint,u.mapExtent=t.extent,u.width=t.width,u.height=t.height;for(s=0,l=f.length;s<l;s++)try{u.layerIds=f[s].identifyLayers,f[s].execute(u,r[s].callback,r[s].errback)}catch(c){console.log(c),r[s].errback(c)}})},u})}).call(this)